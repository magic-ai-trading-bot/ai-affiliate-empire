#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Skip hooks in CI environment
if [ "$CI" = "true" ]; then
  exit 0
fi

echo "Running pre-push validation..."

# Note: Tests are run in CI pipeline, not in pre-push hook
# Developers can run 'npm run test:unit' manually if needed

# 1. Check TypeScript compilation via build
echo "Checking TypeScript compilation..."
npm run build >/dev/null 2>&1
if [ $? -ne 0 ]; then
  echo "ERROR: Build failed. Run 'npm run build' to see errors."
  exit 1
fi

# 2. Run linter (source files only)
echo "Checking code style..."
npx eslint "src/**/*.{ts,tsx}" --max-warnings 10 >/dev/null 2>&1
if [ $? -ne 0 ]; then
  echo "ERROR: Linting failed in source files. Run 'npx eslint src/**/*.ts --fix' to auto-fix issues."
  exit 1
fi

# 3. Check for debug code
echo "Checking for debug code..."
if git diff HEAD --cached | grep -E "debugger|console\.(log|debug|warn)" | grep -v "test\|spec"; then
  echo "WARNING: Debug statements detected. Consider removing them."
fi

echo "âœ“ Pre-push checks passed"
